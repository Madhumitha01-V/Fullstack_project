<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <title>My Account - Perfumy</title>
</head>
<body>

<header class="header">
    <nav class="navbar">
        <div class="logo"><h1>Perfumy</h1></div>
        <ul class="nav-menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#products">Products</a></li>
            <li><a href="index.html#about">About Us</a></li>
            <li><a href="index.html#contact">Contact</a></li>
        </ul>

        <div class="user-actions" id="userActions">
            <a href="cart.html" class="cart-icon">
                üõí <span class="cart-count" id="cartCount">0</span>
            </a>
            <div class="user-account">
                <button class="account-btn">
                    üë§ <span class="username" id="username">Account</span>
                </button>
                <div class="account-dropdown">
                    <a href="account.html">My Account</a>
                    <a href="cart.html">My Cart</a>
                    <a href="#" id="logoutBtn">Logout</a>
                </div>
            </div>
        </div>
    </nav>
</header>

<section class="account-section">
    <div class="container">
        <div class="account-container">

            <!-- SIDEBAR -->
            <div class="account-sidebar">
                <div class="user-profile">
                    <div class="profile-avatar">üë§</div>
                    <h3 id="userFullName">Welcome</h3>
                    <p id="userEmail"></p>
                </div>

                <nav class="account-nav">
                    <a href="#" class="nav-item active" data-section="profile">üë§ Profile</a>
                    <a href="#" class="nav-item" data-section="favorites">‚ù§Ô∏è Favorites</a>
                    <a href="#" class="nav-item" data-section="cart">üõí Cart</a>
                    <a href="#" class="nav-item" data-section="orders">üì¶ Orders</a>
                    <a href="#" class="nav-item logout-btn" id="sidebarLogout">üö™ Logout</a>
                </nav>
            </div>

            <!-- CONTENT -->
            <div class="account-content">

                <!-- PROFILE -->
                <div id="profile-section" class="content-section active">
                    <h2>üë§ Profile Information</h2>
                    <div class="profile-form">
                        <div class="form-row">
                            <input id="firstName" readonly placeholder="First Name">
                            <input id="lastName" readonly placeholder="Last Name">
                        </div>
                        <input id="email" readonly placeholder="Email">
                        <input id="phone" readonly placeholder="Phone">
                    </div>
                </div>

                <!-- FAVORITES -->
                <div id="favorites-section" class="content-section">
                    <h2>‚ù§Ô∏è My Favorites</h2>
                    <div id="favoritesGrid"></div>
                    <div class="empty-state" id="emptyFavorites">
                        <p>No favorites yet</p>
                    </div>
                </div>

                <!-- CART PREVIEW -->
                <div id="cart-section" class="content-section">
                    <h2>üõí My Cart</h2>
                    <div id="cartPreview"></div>
                    <a href="cart.html" class="view-cart-btn">View Full Cart</a>
                </div>

                <!-- ORDERS -->
                <div id="orders-section" class="content-section">
                    <h2>üì¶ Orders</h2>
                    <p>No orders yet</p>
                </div>

            </div>
        </div>
    </div>
</section>

<script src="script.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    if (!isUserLoggedIn()) {
        alert('Please login first');
        window.location.href = 'login.html';
        return;
    }

    initializeUserState();
    loadProfile();
    loadFavorites();
    loadCartPreview();
    setupAccountEvents();
});

/* PROFILE */
function loadProfile() {
    const user = JSON.parse(localStorage.getItem('perfumy_user'));
    if (!user) return;

    document.getElementById('userFullName').textContent =
        `${user.firstName || ''} ${user.lastName || ''}`;
    document.getElementById('userEmail').textContent = user.email || '';
    document.getElementById('firstName').value = user.firstName || '';
    document.getElementById('lastName').value = user.lastName || '';
    document.getElementById('email').value = user.email || '';
    document.getElementById('phone').value = user.phone || '';
}

/* FAVORITES */
function loadFavorites() {
    const favorites = JSON.parse(localStorage.getItem('perfumy_favorites') || '[]');
    const grid = document.getElementById('favoritesGrid');
    const empty = document.getElementById('emptyFavorites');

    grid.innerHTML = '';

    if (favorites.length === 0) {
        empty.style.display = 'block';
        return;
    }

    empty.style.display = 'none';

    favorites.forEach(id => {
        const p = getProductById(id);
        if (!p) return;

        const div = document.createElement('div');
        div.className = 'favorite-item';
        div.innerHTML = `
            <img src="${p.image}">
            <h4>${p.name}</h4>
            <p>‚Çπ${p.price}</p>
            <button onclick="addToCart(p=${p.id})">Add to Cart</button>
            <button onclick="removeFavorite(${p.id})">Remove</button>
        `;
        grid.appendChild(div);
    });
}

function removeFavorite(id) {
    let fav = JSON.parse(localStorage.getItem('perfumy_favorites') || '[]');
    fav = fav.filter(f => f !== id);
    localStorage.setItem('perfumy_favorites', JSON.stringify(fav));
    loadFavorites();
}

/* CART PREVIEW */
function loadCartPreview() {
    const cart = JSON.parse(localStorage.getItem('perfumy_cart') || '[]');
    const preview = document.getElementById('cartPreview');
    preview.innerHTML = '';

    cart.slice(0, 3).forEach(i => {
        const div = document.createElement('div');
        div.innerHTML = `${i.name} √ó ${i.quantity}`;
        preview.appendChild(div);
    });
}

/* NAVIGATION */
function setupAccountEvents() {
    document.querySelectorAll('.nav-item[data-section]').forEach(btn => {
        btn.onclick = e => {
            e.preventDefault();
            switchSection(btn.dataset.section);
        };
    });

    document.getElementById('sidebarLogout').onclick = logout;
}

function switchSection(name) {
    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

    const section = document.getElementById(`${name}-section`);
    const nav = document.querySelector(`[data-section="${name}"]`);

    if (section) section.classList.add('active');
    if (nav) nav.classList.add('active');
}
</script>

</body>
</html>
